<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BRICS Unit Basket v1</title>

<style>
body{background:#0b0f14;color:#ffd700;font-family:Arial;padding:20px}
.container{max-width:960px;margin:auto}
h1{text-align:center}
.price-box{background:#151a21;padding:20px;border-radius:8px;margin-bottom:20px}
.price{font-size:2em;text-align:center;margin-bottom:10px}
.row{margin:4px 0}
#chart{height:420px}
.fx-row{display:flex;justify-content:space-between;background:#1a1f28;padding:6px 10px;border-radius:4px;margin:3px 0;font-size:.95em}
.footnote{font-size:.85em;color:#aaa;margin-top:15px}
</style>
</head>

<body>
<div class="container">
<h1>BRICS Unit Basket v1</h1>

<div class="price-box">
  <div class="price">$<span id="unitUsd">…</span></div>
  <div class="row">Gold TWAP: <span id="goldTwap">…</span></div>
  <div class="row">100 Units: <span id="hundredUsd">…</span></div>
  <div class="row">Updated: <span id="timestamp">…</span></div>
  <div id="fxContainer"></div>
</div>

<div id="chart"></div>

<div class="footnote">
Integrity manifest: <a href="/meta.json" target="_blank">/meta.json</a>
</div>
</div>

<script type="module">
import { createChart } from "/lightweight-charts.esm.js";

const FX_LIST=["BRL","RUB","INR","CNY","ZAR"];
const FX_WEIGHT=0.12;
const GOLD_G_PER_OZ=31.1034768;
const UNIT_BASE_GOLD_G=0.9823;

const chart=createChart(document.getElementById("chart"),{
  layout:{background:{color:"#0b0f14"},textColor:"#ffd700"},
  timeScale:{timeVisible:true,secondsVisible:true}
});

const candleSeries=chart.addCandlestickSeries();

const fxContainer=document.getElementById("fxContainer");
FX_LIST.forEach(c=>{
  const d=document.createElement("div");
  d.className="fx-row";
  d.id="fx_"+c;
  d.innerHTML=`<div>${c}</div><div>…</div>`;
  fxContainer.appendChild(d);
});

async function loadCandles(){
  const r=await fetch("/ohlc?timeframe=1&limit=500");
  const d=await r.json();
  if(d.length) candleSeries.setData(d);
}

async function tick(){
  const d=await (await fetch("/latest.json")).json();
  unitUsd.textContent=d.unit_usd.toFixed(4);
  hundredUsd.textContent=(d.unit_usd*100).toFixed(2);
  goldTwap.textContent=d.gold_usd_per_oz_twap.toFixed(2);
  timestamp.textContent=d.timestamp_utc;

  FX_LIST.forEach(c=>{
    const fx=d.fx_usd_twap[c];
    const usd=(UNIT_BASE_GOLD_G*(d.gold_usd_per_oz_twap/GOLD_G_PER_OZ))*FX_WEIGHT;
    document.querySelector("#fx_"+c+" div:last-child").textContent=
      `$${usd.toFixed(2)} | ${(usd*fx).toFixed(2)} ${c}`;
  });
}

loadCandles();
tick();
setInterval(tick,1000);
</script>
</body>
</html>
